<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Falling Greetings with Controlled Rotation</title>
    <style>
        /* 1. ページ全体の設定 */
        body {
            background-color: black;
            margin: 0;
            height: 100vh;
            overflow: hidden; 
            font-family: 'Arial Black', 'Helvetica Neue', 'Roboto', sans-serif;
            position: relative;
        }

        /* 2. 各テキスト要素の共通設定 */
        .greeting-unit {
            position: absolute;
            white-space: nowrap;
            line-height: 1;
            filter: blur(1px); 
            opacity: 0; /* 生成時透明 */
            
            /* アニメーションを適用: 落下、色変化 */
            animation: fall-down var(--duration) linear var(--delay) infinite,
                       color-change var(--color-duration) linear infinite;
            
            /* 初期回転角度を設定（JSで上書き） */
            transform-origin: center center;
            transform: rotate(var(--rotation));
        }

        /* 3. 落下アニメーションの定義 */
        @keyframes fall-down {
            0% { transform: translate(0, -10vh) rotate(var(--rotation)); opacity: 0; }
            1% { opacity: 0.9; } /* 落下開始直前で不透明に */
            100% { 
                /* 落下中も回転を維持 */
                transform: translate(0, 110vh) rotate(var(--rotation)); 
                opacity: 0; 
            }
        }

        /* 4. 色変化アニメーションの定義 */
        @keyframes color-change {
            0% { color: hsl(0, 100%, 70%); text-shadow: 0 0 5px hsl(0, 100%, 50%), 0 0 10px hsl(0, 100%, 60%); }
            20% { color: hsl(60, 100%, 70%); text-shadow: 0 0 5px hsl(60, 100%, 50%), 0 0 10px hsl(60, 100%, 60%); }
            40% { color: hsl(120, 100%, 70%); text-shadow: 0 0 5px hsl(120, 100%, 50%), 0 0 10px hsl(120, 100%, 60%); }
            60% { color: hsl(240, 100%, 70%); text-shadow: 0 0 5px hsl(240, 100%, 50%), 0 0 10px hsl(240, 100%, 60%); }
            80% { color: hsl(300, 100%, 70%); text-shadow: 0 0 5px hsl(300, 100%, 50%), 0 0 10px hsl(300, 100%, 60%); }
            100% { color: hsl(360, 100%, 70%); text-shadow: 0 0 5px hsl(360, 100%, 50%), 0 0 10px hsl(360, 100%, 60%); }
        }
    </style>
</head>
<body>
    <script>
        const LANGUAGES = [
            "こんにちは", "Hello", "Hola", "你好", "Bonjour", 
            "안녕하세요", "Guten Tag", "Ciao", "Olá", "Здравствуйте",
            "مرحبا", "Goddag", "Dobrý den", "Selamat siang", "Xin chào", 
            "Hujambo", "Shalom", "Kaliméra"
        ];
        
        const NUM_WORDS = 50;   
        const MAX_SIZE_VW = 6;  
        const MIN_SIZE_VW = 2;  
        const MAX_DURATION = 15; 
        const MIN_DURATION = 8;  
        const COLOR_ANIMATION_DURATION = 10; 
        const COL_GRID = 10; 
        const ROW_GRID = 5;  
        let zIndexCounter = NUM_WORDS; // Z-Indexの初期値 (後から生成されたものほど後面に)

        function getRandomNumber(min, max) {
            return Math.random() * (max - min) + min;
        }
// --- 確率制御のための関数 ---
        /**
         * 指定された確率に基づいてランダムな回転角度を取得する関数
         * 0度(40%)、40度(40%)、90度(20%)、-90度(5%)、残りはランダム(35%)
         */
        function getRandomRotation() {
            const rand = Math.random(); // 0から1の乱数
            let rotation = 0;

            if (rand < 0.40) {
                // 40% の確率で 0度
                rotation = 0;
            } else if (rand < 0.40 + 0.20) {
                // 20% の確率で 90度
                rotation = 90;
            } else if (rand < 0.40 + 0.20 + 0.05) {
                // 5% の確率で -90度
                rotation = -90;
            } else {
                // 残り (35%) の確率で -360度から360度の間のランダムな角度
                rotation = getRandomNumber(-360, 360);
            }
            return rotation;
        }
// ----------------------------

        let initialPositions = [];
        for (let r = 0; r < ROW_GRID; r++) {
            for (let c = 0; c < COL_GRID; c++) {
                initialPositions.push({ row: r, col: c });
            }
        }
        initialPositions.sort(() => Math.random() - 0.5);

        /**
         * 文字要素を生成し、ランダムなスタイルとアニメーションを適用する関数
         */
        function createFallingWord(i) {
            const word = document.createElement('div');
            word.textContent = LANGUAGES[Math.floor(Math.random() * LANGUAGES.length)];
            word.classList.add('greeting-unit');

            // 1. サイズ
            const fontSize = getRandomNumber(MIN_SIZE_VW, MAX_SIZE_VW);
            word.style.fontSize = `${fontSize}vw`;

            // 2. グリッドシステムに基づいた初期位置の計算 (重なり回避)
            const pos = initialPositions[i % initialPositions.length];
            const colIndex = pos.col;
            const rowIndex = pos.row;

            const colWidth = 100 / COL_GRID;
            const rowHeight = MAX_DURATION / ROW_GRID;

            const leftPosition = getRandomNumber(colIndex * colWidth, (colIndex + 1) * colWidth);
            word.style.left = `${leftPosition}vw`;

            // 3. 落下アニメーション時間 (速さ) と開始遅延の計算
            const duration = getRandomNumber(MIN_DURATION, MAX_DURATION);
            word.style.setProperty('--duration', `${duration}s`);
            
            const delay = getRandomNumber(0, rowHeight) + (rowIndex * rowHeight);
            word.style.setProperty('--delay', `${delay}s`);

            // 4. 色変化アニメーションの開始遅延と周期を設定
            const colorDelay = getRandomNumber(0, COLOR_ANIMATION_DURATION);
            word.style.setProperty('--color-duration', `${COLOR_ANIMATION_DURATION}s`);
            word.style.animationDelay = `${delay}s, ${colorDelay}s`; 

            // 5. Z軸の順序制御
            word.style.zIndex = zIndexCounter; 
            zIndexCounter--; 

            // 6. ★文字の向き (回転) を確率に基づいて設定★
            const rotation = getRandomRotation(); 
            word.style.setProperty('--rotation', `${rotation}deg`);

            document.body.appendChild(word);
            
            // 7. X軸の微動
            const randomXOffset = getRandomNumber(-100, 100); 
            word.style.transform += ` translateX(${randomXOffset}px)`;
        }

        // 指定した数の文字を生成
        for (let i = 0; i < NUM_WORDS; i++) {
            createFallingWord(i);
        }

    </script>
    // coded by Gemini
</body>
</html>
